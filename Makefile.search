# Makefile pour FAFA AUTO - Module de Recherche Meilisearch
# ==========================================================

.PHONY: help search-up search-down search-init search-test search-status search-logs

# Variables
COMPOSE_FILE := docker-compose.meilisearch.yml
PROJECT_NAME := fafa-search

## Aide
help:
	@echo "🔍 FAFA AUTO - Module de Recherche Meilisearch"
	@echo "=============================================="
	@echo ""
	@echo "Commandes disponibles :"
	@echo "  search-up      - Démarrer Meilisearch et Redis"
	@echo "  search-down    - Arrêter les services"
	@echo "  search-init    - Initialiser les index Meilisearch"
	@echo "  search-test    - Tester Meilisearch"
	@echo "  search-status  - Afficher le statut des services"
	@echo "  search-logs    - Afficher les logs"
	@echo "  search-reset   - Réinitialiser complètement"
	@echo ""

## Démarrage des services
search-up:
	@echo "🚀 Démarrage de Meilisearch et Redis..."
	docker-compose -f $(COMPOSE_FILE) up -d
	@echo "⏳ Attente de la disponibilité des services..."
	@sleep 10
	@echo "✅ Services démarrés !"
	@echo "📊 Interface Meilisearch : http://localhost:7700"

## Arrêt des services
search-down:
	@echo "🛑 Arrêt des services..."
	docker-compose -f $(COMPOSE_FILE) down
	@echo "✅ Services arrêtés !"

## Initialisation des index
search-init:
	@echo "📊 Initialisation des index Meilisearch..."
	@./scripts/init-meilisearch.sh
	@echo "✅ Index initialisés !"

## Test des services
search-test:
	@echo "🔍 Test de Meilisearch..."
	@./scripts/test-meilisearch.sh

## Statut des services
search-status:
	@echo "📊 Statut des services :"
	@docker-compose -f $(COMPOSE_FILE) ps
	@echo ""
	@echo "🔍 Santé de Meilisearch :"
	@curl -s http://localhost:7700/health || echo "❌ Meilisearch indisponible"

## Affichage des logs
search-logs:
	@echo "📋 Logs des services :"
	docker-compose -f $(COMPOSE_FILE) logs -f

## Réinitialisation complète
search-reset:
	@echo "🔄 Réinitialisation complète..."
	docker-compose -f $(COMPOSE_FILE) down -v
	docker-compose -f $(COMPOSE_FILE) up -d
	@sleep 10
	@./scripts/init-meilisearch.sh
	@echo "✅ Réinitialisation terminée !"

## Installation rapide complète
search-install: search-up search-init search-test
	@echo "🎉 Installation complète terminée !"
	@echo "📊 Interface : http://localhost:7700"
	@echo "🔧 Configuration : .env.meilisearch.example"
