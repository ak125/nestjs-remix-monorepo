# Makefile pour FAFA AUTO - Module de Recherche Meilisearch
# ==========================================================

.PHONY: help search-up search-down search-init search-test search-status search-logs

# Variables
COMPOSE_FILE := docker-compose.meilisearch.yml
PROJECT_NAME := fafa-search

## Aide
help:
	@echo "ğŸ” FAFA AUTO - Module de Recherche Meilisearch"
	@echo "=============================================="
	@echo ""
	@echo "Commandes disponibles :"
	@echo "  search-up      - DÃ©marrer Meilisearch et Redis"
	@echo "  search-down    - ArrÃªter les services"
	@echo "  search-init    - Initialiser les index Meilisearch"
	@echo "  search-test    - Tester Meilisearch"
	@echo "  search-status  - Afficher le statut des services"
	@echo "  search-logs    - Afficher les logs"
	@echo "  search-reset   - RÃ©initialiser complÃ¨tement"
	@echo ""

## DÃ©marrage des services
search-up:
	@echo "ğŸš€ DÃ©marrage de Meilisearch et Redis..."
	docker-compose -f $(COMPOSE_FILE) up -d
	@echo "â³ Attente de la disponibilitÃ© des services..."
	@sleep 10
	@echo "âœ… Services dÃ©marrÃ©s !"
	@echo "ğŸ“Š Interface Meilisearch : http://localhost:7700"

## ArrÃªt des services
search-down:
	@echo "ğŸ›‘ ArrÃªt des services..."
	docker-compose -f $(COMPOSE_FILE) down
	@echo "âœ… Services arrÃªtÃ©s !"

## Initialisation des index
search-init:
	@echo "ğŸ“Š Initialisation des index Meilisearch..."
	@./scripts/init-meilisearch.sh
	@echo "âœ… Index initialisÃ©s !"

## Test des services
search-test:
	@echo "ğŸ” Test de Meilisearch..."
	@./scripts/test-meilisearch.sh

## Statut des services
search-status:
	@echo "ğŸ“Š Statut des services :"
	@docker-compose -f $(COMPOSE_FILE) ps
	@echo ""
	@echo "ğŸ” SantÃ© de Meilisearch :"
	@curl -s http://localhost:7700/health || echo "âŒ Meilisearch indisponible"

## Affichage des logs
search-logs:
	@echo "ğŸ“‹ Logs des services :"
	docker-compose -f $(COMPOSE_FILE) logs -f

## RÃ©initialisation complÃ¨te
search-reset:
	@echo "ğŸ”„ RÃ©initialisation complÃ¨te..."
	docker-compose -f $(COMPOSE_FILE) down -v
	docker-compose -f $(COMPOSE_FILE) up -d
	@sleep 10
	@./scripts/init-meilisearch.sh
	@echo "âœ… RÃ©initialisation terminÃ©e !"

## Installation rapide complÃ¨te
search-install: search-up search-init search-test
	@echo "ğŸ‰ Installation complÃ¨te terminÃ©e !"
	@echo "ğŸ“Š Interface : http://localhost:7700"
	@echo "ğŸ”§ Configuration : .env.meilisearch.example"
