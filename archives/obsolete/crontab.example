##############################################################################
# ðŸ•’ CRONTAB CONFIGURATION - PRODUCTION
#
# Installation : crontab -e
# VÃ©rification : crontab -l
##############################################################################

# Variables d'environnement
SHELL=/bin/bash
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=devops@automecanik.com

##############################################################################
# SITEMAPS GENERATION
##############################################################################

# GÃ©nÃ©ration nightly Ã  3h du matin (tous les jours)
0 3 * * * /workspaces/nestjs-remix-monorepo/scripts/cron-sitemap-nightly.sh

# GÃ©nÃ©ration delta (toutes les 6h pour fraÃ®cheur)
0 */6 * * * curl -X POST http://localhost:3000/sitemap-v2/delta/generate

##############################################################################
# CLEANUP & MAINTENANCE
##############################################################################

# Cleanup Redis cache (tous les dimanches Ã  4h)
0 4 * * 0 curl -X POST http://localhost:3000/sitemap-v2/delta/cleanup

# Cleanup vieux logs (tous les lundis Ã  5h)
0 5 * * 1 find /workspaces/nestjs-remix-monorepo/logs -name "*.log" -mtime +30 -delete

##############################################################################
# MONITORING & HEALTH CHECKS
##############################################################################

# VÃ©rifier santÃ© API (toutes les 15 minutes)
*/15 * * * * curl -f http://localhost:3000/health || echo "API Health Check Failed" | mail -s "AutoMecanik API Alert" devops@automecanik.com

# VÃ©rifier taille sitemaps (tous les jours Ã  6h)
0 6 * * * du -sh /workspaces/nestjs-remix-monorepo/public/sitemaps/ | mail -s "Sitemap Size Report" devops@automecanik.com

##############################################################################
# BACKUP
##############################################################################

# Backup sitemaps (tous les jours Ã  7h)
0 7 * * * tar -czf /backups/sitemaps-$(date +\%Y\%m\%d).tar.gz /workspaces/nestjs-remix-monorepo/public/sitemaps/

# Cleanup anciens backups (> 14 jours, tous les dimanches)
0 8 * * 0 find /backups -name "sitemaps-*.tar.gz" -mtime +14 -delete
