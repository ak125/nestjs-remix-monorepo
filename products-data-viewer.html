<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualisation Donn√©es Products - Syst√®me Automobile</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 8px; 
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .stats { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px;
        }
        .stat-card { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 20px; 
            border-radius: 8px; 
            text-align: center;
        }
        .stat-number { 
            font-size: 2em; 
            font-weight: bold; 
            display: block;
        }
        .section { 
            margin: 30px 0;
        }
        .section h2 { 
            color: #333; 
            border-bottom: 3px solid #667eea; 
            padding-bottom: 10px;
        }
        .data-list { 
            max-height: 400px; 
            overflow-y: auto; 
            border: 1px solid #ddd; 
            border-radius: 4px;
        }
        .item { 
            padding: 10px; 
            border-bottom: 1px solid #eee; 
            display: flex; 
            justify-content: space-between;
        }
        .item:nth-child(even) { 
            background: #f9f9f9;
        }
        .item-name { 
            font-weight: bold; 
            color: #333;
        }
        .item-details { 
            color: #666; 
            font-size: 0.9em;
        }
        .loading { 
            text-align: center; 
            color: #667eea; 
            font-style: italic;
        }
        .error { 
            color: #e74c3c; 
            background: #ffeaea; 
            padding: 10px; 
            border-radius: 4px;
        }
        button { 
            background: #667eea; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin: 5px;
        }
        button:hover { 
            background: #5a6fd8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöó Syst√®me Products - Donn√©es R√©elles</h1>
        <p><strong>Base de donn√©es :</strong> 4+ millions de pi√®ces automobiles</p>
        
        <!-- Statistiques -->
        <div class="stats" id="stats">
            <div class="stat-card">
                <span class="stat-number" id="totalProducts">4,036,045</span>
                <div>Produits Totaux</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="totalCategories">9,266</span>
                <div>Cat√©gories/Gammes</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="totalBrands">--</span>
                <div>Marques Auto</div>
            </div>
            <div class="stat-card">
                <span class="stat-number">‚úÖ LIVE</span>
                <div>Connexion API</div>
            </div>
        </div>

        <!-- Section Gammes -->
        <div class="section">
            <h2>üè∑Ô∏è Gammes de Pi√®ces (√âchantillon)</h2>
            <button onclick="loadGammes()">üì• Charger les Gammes</button>
            <button onclick="loadAllGammes()">üìã Voir Plus de Gammes</button>
            <div id="gammes-content" class="loading">Cliquez sur "Charger les Gammes" pour voir les donn√©es...</div>
        </div>

        <!-- Section Pi√®ces -->
        <div class="section">
            <h2>üîß Catalogue de Pi√®ces (√âchantillon)</h2>
            <button onclick="loadPieces()">üì• Charger les Pi√®ces</button>
            <button onclick="loadMorePieces()">üìã Voir Plus de Pi√®ces</button>
            <div id="pieces-content" class="loading">Cliquez sur "Charger les Pi√®ces" pour voir les donn√©es...</div>
        </div>

        <!-- Section Debug -->
        <div class="section">
            <h2>üîç Informations Techniques</h2>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 4px; font-family: monospace;">
                <strong>Backend API:</strong> http://localhost:3000<br>
                <strong>Endpoints test√©s:</strong><br>
                ‚úÖ /api/products/stats ‚Üí Statistiques globales<br>
                ‚úÖ /api/products/gammes ‚Üí Liste des gammes<br>
                ‚úÖ /api/products/pieces-catalog ‚Üí Catalogue de pi√®ces<br>
                <strong>Base de donn√©es:</strong> Supabase (tables: pieces, pieces_gamme)<br>
            </div>
        </div>
    </div>

    <script>
        // Charger les statistiques au d√©marrage
        loadStats();

        async function loadStats() {
            try {
                const response = await fetch('http://localhost:3000/api/products/stats', {
                    headers: { 'internal-call': 'true' }
                });
                const data = await response.json();
                
                if (data.totalProducts) document.getElementById('totalProducts').textContent = data.totalProducts.toLocaleString();
                if (data.totalCategories) document.getElementById('totalCategories').textContent = data.totalCategories.toLocaleString();
                if (data.totalBrands) document.getElementById('totalBrands').textContent = data.totalBrands.toLocaleString();
            } catch (error) {
                console.error('Erreur chargement stats:', error);
            }
        }

        async function loadGammes() {
            const container = document.getElementById('gammes-content');
            container.innerHTML = '<div class="loading">üì• Chargement des gammes...</div>';
            
            try {
                const response = await fetch('http://localhost:3000/api/products/gammes', {
                    headers: { 'internal-call': 'true' }
                });
                const gammes = await response.json();
                
                let html = `<div class="data-list">`;
                html += `<div style="padding: 10px; background: #667eea; color: white; font-weight: bold;">
                    üìä ${gammes.length} gammes trouv√©es (√©chantillon des 50 premi√®res)
                </div>`;
                
                gammes.slice(0, 50).forEach((gamme, index) => {
                    html += `
                        <div class="item">
                            <div>
                                <div class="item-name">${gamme.name}</div>
                                <div class="item-details">ID: ${gamme.id} | Actif: ${gamme.is_active ? '‚úÖ' : '‚ùå'} | Top: ${gamme.is_top ? '‚≠ê' : '‚Äî'}</div>
                            </div>
                            <div style="text-align: right; color: #667eea; font-size: 0.8em;">
                                #${index + 1}
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
                container.innerHTML = html;
                
            } catch (error) {
                container.innerHTML = `<div class="error">‚ùå Erreur: ${error.message}</div>`;
            }
        }

        async function loadAllGammes() {
            const container = document.getElementById('gammes-content');
            container.innerHTML = '<div class="loading">üì• Chargement de TOUTES les gammes...</div>';
            
            try {
                const response = await fetch('http://localhost:3000/api/products/gammes', {
                    headers: { 'internal-call': 'true' }
                });
                const gammes = await response.json();
                
                let html = `<div class="data-list">`;
                html += `<div style="padding: 10px; background: #667eea; color: white; font-weight: bold;">
                    üìä TOUTES LES ${gammes.length} GAMMES TROUV√âES
                </div>`;
                
                gammes.forEach((gamme, index) => {
                    html += `
                        <div class="item">
                            <div>
                                <div class="item-name">${gamme.name}</div>
                                <div class="item-details">ID: ${gamme.id} | Actif: ${gamme.is_active ? '‚úÖ' : '‚ùå'} | Top: ${gamme.is_top ? '‚≠ê' : '‚Äî'}</div>
                            </div>
                            <div style="text-align: right; color: #667eea; font-size: 0.8em;">
                                #${index + 1}
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
                container.innerHTML = html;
                
            } catch (error) {
                container.innerHTML = `<div class="error">‚ùå Erreur: ${error.message}</div>`;
            }
        }

        async function loadPieces() {
            const container = document.getElementById('pieces-content');
            container.innerHTML = '<div class="loading">üì• Chargement des pi√®ces...</div>';
            
            try {
                const response = await fetch('http://localhost:3000/api/products/pieces-catalog?limit=20', {
                    headers: { 'internal-call': 'true' }
                });
                const data = await response.json();
                
                let html = `<div class="data-list">`;
                html += `<div style="padding: 10px; background: #667eea; color: white; font-weight: bold;">
                    üìä ${data.products.length} pi√®ces trouv√©es (√©chantillon)
                </div>`;
                
                data.products.forEach((piece, index) => {
                    html += `
                        <div class="item">
                            <div>
                                <div class="item-name">${piece.piece_name}</div>
                                <div class="item-details">SKU: ${piece.piece_sku} | ID: ${piece.piece_id} | Actif: ${piece.piece_activ ? '‚úÖ' : '‚ùå'}</div>
                            </div>
                            <div style="text-align: right; color: #667eea; font-size: 0.8em;">
                                #${index + 1}
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
                container.innerHTML = html;
                
            } catch (error) {
                container.innerHTML = `<div class="error">‚ùå Erreur: ${error.message}</div>`;
            }
        }

        async function loadMorePieces() {
            const container = document.getElementById('pieces-content');
            container.innerHTML = '<div class="loading">üì• Chargement de plus de pi√®ces...</div>';
            
            try {
                const response = await fetch('http://localhost:3000/api/products/pieces-catalog?limit=100', {
                    headers: { 'internal-call': 'true' }
                });
                const data = await response.json();
                
                let html = `<div class="data-list">`;
                html += `<div style="padding: 10px; background: #667eea; color: white; font-weight: bold;">
                    üìä ${data.products.length} pi√®ces trouv√©es (limite 100)
                </div>`;
                
                data.products.forEach((piece, index) => {
                    html += `
                        <div class="item">
                            <div>
                                <div class="item-name">${piece.piece_name}</div>
                                <div class="item-details">SKU: ${piece.piece_sku} | ID: ${piece.piece_id} | Actif: ${piece.piece_activ ? '‚úÖ' : '‚ùå'}</div>
                            </div>
                            <div style="text-align: right; color: #667eea; font-size: 0.8em;">
                                #${index + 1}
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
                container.innerHTML = html;
                
            } catch (error) {
                container.innerHTML = `<div class="error">‚ùå Erreur: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
