<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔧 Test Fix VehicleSelector - URLs .html</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .test-section { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .url-test { margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .loading { background: #fff3cd; border-color: #ffeaa7; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .results { margin-top: 20px; }
        iframe { width: 100%; height: 400px; border: 1px solid #ddd; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>🔧 Test Fix VehicleSelector - Gestion des URLs .html</h1>
    
    <div class="test-section">
        <h2>📝 Contexte du Bug</h2>
        <p><strong>Problème initial :</strong> "le selecteur de vehicule genere des 404"</p>
        <p><strong>Cause identifiée :</strong> VehicleSelectorV2 génère des URLs avec extension .html mais les routes Remix ne les gèrent pas</p>
        <p><strong>URLs générées par VehicleSelector :</strong> <code>/constructeurs/brand-id/model-id/type-id.html</code></p>
        <p><strong>Routes Remix existantes :</strong> <code>constructeurs.$brand.$model.$type.tsx</code> (sans .html)</p>
    </div>

    <div class="test-section">
        <h2>🧪 Tests de Validation</h2>
        <button onclick="testUrls()">🚀 Lancer les tests</button>
        <button onclick="clearResults()">🗑️ Effacer les résultats</button>
        
        <div id="results" class="results"></div>
    </div>

    <div class="test-section">
        <h2>📊 URLs de Test</h2>
        <p>Tests sur véhicule CITROËN C4 II 1.6 HDi :</p>
        <ul>
            <li><strong>Avec .html :</strong> <code>/constructeurs/citroen-46/c4-ii-46031/type-470.html</code></li>
            <li><strong>Sans .html :</strong> <code>/constructeurs/citroen-46/c4-ii-46031/type-470</code></li>
            <li><strong>Page d'accueil :</strong> <code>/</code></li>
            <li><strong>Constructeurs :</strong> <code>/constructeurs</code></li>
        </ul>
    </div>

    <script>
        const baseUrl = 'http://localhost:3000';
        
        const testUrls = [
            {
                name: '🏠 Page d\'accueil', 
                url: '/',
                expected: 'Devrait fonctionner normalement'
            },
            {
                name: '🏗️ Page constructeurs', 
                url: '/constructeurs',
                expected: 'Devrait lister les constructeurs'
            },
            {
                name: '❌ URL avec .html (AVANT FIX)', 
                url: '/constructeurs/citroen-46/c4-ii-46031/type-470.html',
                expected: 'ERREUR 404 - C\'est le problème à résoudre'
            },
            {
                name: '✅ URL sans .html (RÉFÉRENCE)', 
                url: '/constructeurs/citroen-46/c4-ii-46031/type-470',
                expected: 'Devrait fonctionner et afficher les détails du véhicule'
            },
            {
                name: '🔧 Test autre véhicule .html', 
                url: '/constructeurs/bmw-33/serie-1-f20-33019/125-d-3513.html',
                expected: 'ERREUR 404 si pas fixé'
            }
        ];

        async function testUrl(testCase) {
            const resultDiv = document.createElement('div');
            resultDiv.className = 'url-test loading';
            resultDiv.innerHTML = `
                <h4>${testCase.name}</h4>
                <p><strong>URL :</strong> <code>${testCase.url}</code></p>
                <p><strong>Attendu :</strong> ${testCase.expected}</p>
                <p>🔄 Test en cours...</p>
            `;
            
            document.getElementById('results').appendChild(resultDiv);
            
            try {
                const startTime = Date.now();
                const response = await fetch(baseUrl + testCase.url);
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                const text = await response.text();
                const isSuccess = response.ok && !text.includes('Page non trouvée');
                
                // Chercher des indicateurs de contenu spécifique
                const hasVehicleData = text.includes('CITROËN') || text.includes('BMW') || text.includes('type_id');
                const is404Page = text.includes('Page non trouvée') || text.includes('404');
                const hasHomepageContent = text.includes('E-Commerce Platform') && testCase.url === '/';
                
                let status = '❓ Statut inconnu';
                let statusClass = 'loading';
                
                if (response.ok) {
                    if (is404Page) {
                        status = '❌ 404 - Page non trouvée';
                        statusClass = 'error';
                    } else if (hasVehicleData) {
                        status = '✅ Données véhicule présentes';
                        statusClass = 'success';
                    } else if (hasHomepageContent && testCase.url === '/') {
                        status = '✅ Page d\'accueil OK';
                        statusClass = 'success';
                    } else {
                        status = '✅ Page chargée';
                        statusClass = 'success';
                    }
                } else {
                    status = `❌ Erreur HTTP ${response.status}`;
                    statusClass = 'error';
                }
                
                resultDiv.className = `url-test ${statusClass}`;
                resultDiv.innerHTML = `
                    <h4>${testCase.name}</h4>
                    <p><strong>URL :</strong> <code>${testCase.url}</code></p>
                    <p><strong>Statut :</strong> ${status} (${responseTime}ms)</p>
                    <p><strong>HTTP :</strong> ${response.status} ${response.statusText}</p>
                    <p><strong>Attendu :</strong> ${testCase.expected}</p>
                    ${hasVehicleData ? '<p>🚗 <strong>Données véhicule détectées !</strong></p>' : ''}
                    ${is404Page ? '<p>🚫 <strong>Page 404 détectée</strong></p>' : ''}
                    <button onclick="openUrlInIframe('${testCase.url}', this)">👁️ Voir le rendu</button>
                `;
                
            } catch (error) {
                resultDiv.className = 'url-test error';
                resultDiv.innerHTML = `
                    <h4>${testCase.name}</h4>
                    <p><strong>URL :</strong> <code>${testCase.url}</code></p>
                    <p><strong>Erreur :</strong> ❌ ${error.message}</p>
                    <p><strong>Attendu :</strong> ${testCase.expected}</p>
                `;
            }
        }

        async function testUrls() {
            document.getElementById('results').innerHTML = '<h3>🔄 Tests en cours...</h3>';
            
            for (const testCase of testUrls) {
                await testUrl(testCase);
                await new Promise(resolve => setTimeout(resolve, 500)); // Pause entre les tests
            }
            
            // Résumé final
            const resultDiv = document.createElement('div');
            resultDiv.className = 'url-test';
            resultDiv.innerHTML = `
                <h3>📋 Résumé des Tests</h3>
                <p><strong>Tests terminés à :</strong> ${new Date().toLocaleTimeString()}</p>
                <p><strong>Objectif :</strong> Vérifier si les URLs .html génèrent encore des 404</p>
                <p><strong>Si les URLs .html montrent encore des 404, le problème persiste.</strong></p>
                <p><strong>Si elles fonctionnent, le VehicleSelector est réparé ! 🎉</strong></p>
            `;
            
            document.getElementById('results').appendChild(resultDiv);
        }

        function openUrlInIframe(url, button) {
            // Supprimer l'iframe existant s'il y en a un
            const existingIframe = button.parentNode.querySelector('iframe');
            if (existingIframe) {
                existingIframe.remove();
                return;
            }
            
            const iframe = document.createElement('iframe');
            iframe.src = baseUrl + url;
            iframe.style.marginTop = '10px';
            button.parentNode.appendChild(iframe);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
    </script>
</body>
</html>