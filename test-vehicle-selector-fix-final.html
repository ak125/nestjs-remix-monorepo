<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ Test Fix VehicleSelector - URLs .html</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .test-section { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .url-test { margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .loading { background: #fff3cd; border-color: #ffeaa7; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .results { margin-top: 20px; }
        iframe { width: 100%; height: 400px; border: 1px solid #ddd; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ğŸ”§ Test Fix VehicleSelector - Gestion des URLs .html</h1>
    
    <div class="test-section">
        <h2>ğŸ“ Contexte du Bug</h2>
        <p><strong>ProblÃ¨me initial :</strong> "le selecteur de vehicule genere des 404"</p>
        <p><strong>Cause identifiÃ©e :</strong> VehicleSelectorV2 gÃ©nÃ¨re des URLs avec extension .html mais les routes Remix ne les gÃ¨rent pas</p>
        <p><strong>URLs gÃ©nÃ©rÃ©es par VehicleSelector :</strong> <code>/constructeurs/brand-id/model-id/type-id.html</code></p>
        <p><strong>Routes Remix existantes :</strong> <code>constructeurs.$brand.$model.$type.tsx</code> (sans .html)</p>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª Tests de Validation</h2>
        <button onclick="testUrls()">ğŸš€ Lancer les tests</button>
        <button onclick="clearResults()">ğŸ—‘ï¸ Effacer les rÃ©sultats</button>
        
        <div id="results" class="results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š URLs de Test</h2>
        <p>Tests sur vÃ©hicule CITROÃ‹N C4 II 1.6 HDi :</p>
        <ul>
            <li><strong>Avec .html :</strong> <code>/constructeurs/citroen-46/c4-ii-46031/type-470.html</code></li>
            <li><strong>Sans .html :</strong> <code>/constructeurs/citroen-46/c4-ii-46031/type-470</code></li>
            <li><strong>Page d'accueil :</strong> <code>/</code></li>
            <li><strong>Constructeurs :</strong> <code>/constructeurs</code></li>
        </ul>
    </div>

    <script>
        const baseUrl = 'http://localhost:3000';
        
        const testUrls = [
            {
                name: 'ğŸ  Page d\'accueil', 
                url: '/',
                expected: 'Devrait fonctionner normalement'
            },
            {
                name: 'ğŸ—ï¸ Page constructeurs', 
                url: '/constructeurs',
                expected: 'Devrait lister les constructeurs'
            },
            {
                name: 'âŒ URL avec .html (AVANT FIX)', 
                url: '/constructeurs/citroen-46/c4-ii-46031/type-470.html',
                expected: 'ERREUR 404 - C\'est le problÃ¨me Ã  rÃ©soudre'
            },
            {
                name: 'âœ… URL sans .html (RÃ‰FÃ‰RENCE)', 
                url: '/constructeurs/citroen-46/c4-ii-46031/type-470',
                expected: 'Devrait fonctionner et afficher les dÃ©tails du vÃ©hicule'
            },
            {
                name: 'ğŸ”§ Test autre vÃ©hicule .html', 
                url: '/constructeurs/bmw-33/serie-1-f20-33019/125-d-3513.html',
                expected: 'ERREUR 404 si pas fixÃ©'
            }
        ];

        async function testUrl(testCase) {
            const resultDiv = document.createElement('div');
            resultDiv.className = 'url-test loading';
            resultDiv.innerHTML = `
                <h4>${testCase.name}</h4>
                <p><strong>URL :</strong> <code>${testCase.url}</code></p>
                <p><strong>Attendu :</strong> ${testCase.expected}</p>
                <p>ğŸ”„ Test en cours...</p>
            `;
            
            document.getElementById('results').appendChild(resultDiv);
            
            try {
                const startTime = Date.now();
                const response = await fetch(baseUrl + testCase.url);
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                const text = await response.text();
                const isSuccess = response.ok && !text.includes('Page non trouvÃ©e');
                
                // Chercher des indicateurs de contenu spÃ©cifique
                const hasVehicleData = text.includes('CITROÃ‹N') || text.includes('BMW') || text.includes('type_id');
                const is404Page = text.includes('Page non trouvÃ©e') || text.includes('404');
                const hasHomepageContent = text.includes('E-Commerce Platform') && testCase.url === '/';
                
                let status = 'â“ Statut inconnu';
                let statusClass = 'loading';
                
                if (response.ok) {
                    if (is404Page) {
                        status = 'âŒ 404 - Page non trouvÃ©e';
                        statusClass = 'error';
                    } else if (hasVehicleData) {
                        status = 'âœ… DonnÃ©es vÃ©hicule prÃ©sentes';
                        statusClass = 'success';
                    } else if (hasHomepageContent && testCase.url === '/') {
                        status = 'âœ… Page d\'accueil OK';
                        statusClass = 'success';
                    } else {
                        status = 'âœ… Page chargÃ©e';
                        statusClass = 'success';
                    }
                } else {
                    status = `âŒ Erreur HTTP ${response.status}`;
                    statusClass = 'error';
                }
                
                resultDiv.className = `url-test ${statusClass}`;
                resultDiv.innerHTML = `
                    <h4>${testCase.name}</h4>
                    <p><strong>URL :</strong> <code>${testCase.url}</code></p>
                    <p><strong>Statut :</strong> ${status} (${responseTime}ms)</p>
                    <p><strong>HTTP :</strong> ${response.status} ${response.statusText}</p>
                    <p><strong>Attendu :</strong> ${testCase.expected}</p>
                    ${hasVehicleData ? '<p>ğŸš— <strong>DonnÃ©es vÃ©hicule dÃ©tectÃ©es !</strong></p>' : ''}
                    ${is404Page ? '<p>ğŸš« <strong>Page 404 dÃ©tectÃ©e</strong></p>' : ''}
                    <button onclick="openUrlInIframe('${testCase.url}', this)">ğŸ‘ï¸ Voir le rendu</button>
                `;
                
            } catch (error) {
                resultDiv.className = 'url-test error';
                resultDiv.innerHTML = `
                    <h4>${testCase.name}</h4>
                    <p><strong>URL :</strong> <code>${testCase.url}</code></p>
                    <p><strong>Erreur :</strong> âŒ ${error.message}</p>
                    <p><strong>Attendu :</strong> ${testCase.expected}</p>
                `;
            }
        }

        async function testUrls() {
            document.getElementById('results').innerHTML = '<h3>ğŸ”„ Tests en cours...</h3>';
            
            for (const testCase of testUrls) {
                await testUrl(testCase);
                await new Promise(resolve => setTimeout(resolve, 500)); // Pause entre les tests
            }
            
            // RÃ©sumÃ© final
            const resultDiv = document.createElement('div');
            resultDiv.className = 'url-test';
            resultDiv.innerHTML = `
                <h3>ğŸ“‹ RÃ©sumÃ© des Tests</h3>
                <p><strong>Tests terminÃ©s Ã  :</strong> ${new Date().toLocaleTimeString()}</p>
                <p><strong>Objectif :</strong> VÃ©rifier si les URLs .html gÃ©nÃ¨rent encore des 404</p>
                <p><strong>Si les URLs .html montrent encore des 404, le problÃ¨me persiste.</strong></p>
                <p><strong>Si elles fonctionnent, le VehicleSelector est rÃ©parÃ© ! ğŸ‰</strong></p>
            `;
            
            document.getElementById('results').appendChild(resultDiv);
        }

        function openUrlInIframe(url, button) {
            // Supprimer l'iframe existant s'il y en a un
            const existingIframe = button.parentNode.querySelector('iframe');
            if (existingIframe) {
                existingIframe.remove();
                return;
            }
            
            const iframe = document.createElement('iframe');
            iframe.src = baseUrl + url;
            iframe.style.marginTop = '10px';
            button.parentNode.appendChild(iframe);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
    </script>
</body>
</html>