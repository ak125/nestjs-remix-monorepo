generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = "postgresql://MASSDOC_owner:Fv4Eang6HxBb@ep-young-haze-a2gss4oh-pooler.eu-central-1.aws.neon.tech/MASSDOC?sslmode=require"
}

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  name      String?
  password  String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  sessions  Session[]
}

model Session {
  id           String  @id @default(cuid())
  userId       String
  ipAddress    String?
  userAgent    String?
  sessionToken String  @unique
  user         User    @relation(fields: [userId], references: [id])
}

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ğŸ§ª SEO CRAWL BUDGET A/B TESTING
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

model CrawlBudgetExperiment {
  id               String    @id @default(uuid())
  name             String
  description      String?
  action           String    // exclude, include, reduce
  targetFamilies   String[]  // Array de codes gammes/catÃ©gories
  reductionPercent Int?      // Pour action=reduce (ex: 50%)
  durationDays     Int       @default(30)
  status           String    @default("draft") // draft, running, paused, completed
  baseline         Json?     // MÃ©triques 30j avant {crawlRate, indexation, traffic}
  startedAt        DateTime?
  completedAt      DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  metrics CrawlBudgetMetric[]

  @@map("crawl_budget_experiments")
}

model CrawlBudgetMetric {
  id                 String   @id @default(uuid())
  experimentId       String
  date               DateTime
  totalCrawledUrls   Int
  crawlRequestsCount Int
  avgCrawlRate       Float
  indexedUrls        Int
  indexationRate     Float
  organicSessions    Int?
  organicConversions Int?
  familyMetrics      Json?    // [{familyCode, crawledUrls, indexedUrls, avgPosition}]

  experiment CrawlBudgetExperiment @relation(fields: [experimentId], references: [id], onDelete: Cascade)

  @@unique([experimentId, date])
  @@index([experimentId])
  @@index([date])
  @@map("crawl_budget_metrics")
}
