# Configuration du système AI Agents (Python Local)

# Seuils de Détection
thresholds:
  # Fichiers massifs (lignes de code)
  massive_files:
    tsx_component: 500
    route_file: 400
    service_file: 300
    general: 500
  
  # Duplications
  duplication:
    min_tokens: 6
    min_lines: 5
    similarity_threshold: 0.95
  
  # Dead Code
  dead_code:
    untouched_days: 30
    min_confidence: 0.9
  
  # CSS Patterns
  css:
    min_occurrences: 50
    min_key_pages: 3
  
  # Performance
  performance:
    p95_api_ms: 200
    p95_ssr_ms: 500
    bundle_size_kb: 500
    build_time_seconds: 300

# Corrections Automatiques (sans review humaine)
auto_fix:
  # Safe (toujours auto)
  dead_code: true
  lint_errors: true
  format_code: true
  unused_imports: true
  
  # Semi-safe (nécessite validation)
  duplications: false
  massive_files: false
  css_patterns: false
  cycles: false

# Tests & Validation
tests:
  # Gates obligatoires
  required_gates:
    - M1  # Contracts
    - M5  # Performance budgets
    - M6  # Graph (cycles)
    - M7  # Diff-coverage
  
  # Gates optionnels (warning seulement)
  optional_gates:
    - M2  # Mutation testing
    - M3  # UI snapshots
    - M4  # Shadow traffic
  
  # Seuils de validation
  diff_coverage_min: 80
  mutation_score_min: 80
  ui_ssim_min: 0.99
  
  # Skip en dev (plus rapide)
  skip_mutation_in_dev: true
  skip_ui_snapshots_in_dev: true
  skip_shadow_traffic_in_dev: true

# Exclusions
exclude:
  # Dossiers
  directories:
    - "node_modules"
    - "dist"
    - "build"
    - ".next"
    - ".cache"
    - "coverage"
    - ".git"
    - "__pycache__"
    - ".venv"
    - "venv"
  
  # Fichiers
  patterns:
    - "*.min.js"
    - "*.d.ts"
    - "*.test.ts"
    - "*.test.tsx"
    - "*.spec.ts"
    - "*.spec.tsx"
    - "migrations/*.sql"
    - "fixtures/*.json"
    - "mocks/*.ts"
  
  # Dead code whitelist (scripts CLI, crons...)
  dead_code_whitelist:
    - "scripts/*.sh"
    - "scripts/*.js"
    - "bin/*"
    - "cli/*.ts"

# Reporting
output:
  format: "markdown"  # markdown | json | html
  verbose: true
  show_evidence: true
  save_reports: true
  
  # Chemins
  reports_dir: ".ai-agents/reports"
  evidence_dir: ".ai-agents/evidence"
  logs_dir: ".ai-agents/logs"

# Risk Scoring (F15)
risk:
  weights:
    surface: 0.4          # Lines changed / 200
    criticality: 0.3      # Module importance
    bug_history: 0.2      # Recent bugs
    instability: 0.1      # Commit volatility
  
  # Seuils décision
  low_risk_max: 30
  medium_risk_max: 60
  # > 60 = high risk

# Confidence Scoring (F15)
confidence:
  weights:
    tests_pass: 0.4       # M1-M7 all green
    perf_stable: 0.3      # Budgets OK
    diff_coverage: 0.2    # >= 80%
    evidence: 0.1         # Complete evidence
  
  # Seuils décision
  high_confidence_min: 95
  medium_confidence_min: 90
  # < 90 = low confidence

# Decision Matrix
decision:
  # Auto-commit si:
  auto_commit_if:
    max_risk: 30
    min_confidence: 95
    all_gates_pass: true
  
  # Review requise si:
  review_required_if:
    max_risk: 60
    min_confidence: 90
  
  # Reject (needs-human) si:
  reject_if:
    min_risk: 61  # > 60
    max_confidence: 89  # < 90

# Git Integration
git:
  # Pre-commit hook
  pre_commit:
    enabled: true
    auto_stage_fixes: true
    block_on_failure: true
  
  # Pre-push hook
  pre_push:
    enabled: false  # Optionnel
    run_full_suite: true

# Mode
mode: "local"  # local | ci | production

# Logging
logging:
  level: "INFO"  # DEBUG | INFO | WARNING | ERROR
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: ".ai-agents/logs/latest.log"
  max_bytes: 10485760  # 10MB
  backup_count: 5
