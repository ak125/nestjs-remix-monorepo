# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ§ª TESTS API - SYSTÃˆME DE PAIEMENT
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Utiliser avec VSCode REST Client ou similaire
# Base URL : http://localhost:3000
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

@baseUrl = http://localhost:3000
@apiUrl = {{baseUrl}}/api/payments

### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
### 1. SANTÃ‰ & CONFIGURATION
### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### 1.1 Obtenir les mÃ©thodes de paiement disponibles
GET {{apiUrl}}/methods/available
Content-Type: application/json

### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
### 2. CRÃ‰ATION DE PAIEMENT
### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### 2.1 CrÃ©er un paiement simple (Cyberplus)
POST {{apiUrl}}
Content-Type: application/json

{
  "amount": 99.99,
  "currency": "EUR",
  "method": "CYBERPLUS",
  "userId": "test-user-123",
  "orderId": "ORD-2025-001",
  "description": "Test paiement API",
  "customerEmail": "test@example.com",
  "returnUrl": "http://localhost:5173/payment/success",
  "cancelUrl": "http://localhost:5173/payment/cancel"
}

### 2.2 CrÃ©er un paiement avec carte de crÃ©dit
POST {{apiUrl}}
Content-Type: application/json

{
  "amount": 149.50,
  "currency": "EUR",
  "method": "CREDIT_CARD",
  "userId": "test-user-456",
  "orderId": "ORD-2025-002",
  "description": "Achat piÃ¨ces auto",
  "customerEmail": "client@automecanik.fr"
}

### 2.3 [TEST] CrÃ©er un paiement avec consignes (Phase 6)
POST {{apiUrl}}/test/create-with-consignes
Content-Type: application/json

{
  "orderId": "ORD-TEST-CONSIGNES-001"
}

### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
### 3. CONSULTATION DE PAIEMENTS
### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### 3.1 Obtenir les dÃ©tails d'un paiement par ID
# Remplacer {paymentId} par un vrai ID de paiement
GET {{apiUrl}}/pay_1234567890
Content-Type: application/json

### 3.2 Obtenir un paiement par rÃ©fÃ©rence
# Remplacer {reference} par une vraie rÃ©fÃ©rence (ex: PAY_1696502400_ABC123)
GET {{apiUrl}}/reference/PAY_1696502400_ABC123
Content-Type: application/json

### 3.3 Obtenir les paiements d'un utilisateur
GET {{apiUrl}}/user/test-user-123?limit=10
Content-Type: application/json

### 3.4 Obtenir le paiement d'une commande
GET {{apiUrl}}/order/ORD-2025-001
Content-Type: application/json

### 3.5 Obtenir l'historique des transactions d'un paiement
GET {{apiUrl}}/pay_1234567890/transactions
Content-Type: application/json

### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
### 4. GESTION DES PAIEMENTS
### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### 4.1 Annuler un paiement en attente
POST {{apiUrl}}/pay_1234567890/cancel
Content-Type: application/json

### 4.2 Mettre Ã  jour le statut d'un paiement (Admin)
PATCH {{apiUrl}}/pay_1234567890/status
Content-Type: application/json

{
  "status": "COMPLETED",
  "providerTransactionId": "TXN_ABC123"
}

### 4.3 Rembourser un paiement - Remboursement total (Admin)
POST {{apiUrl}}/pay_1234567890/refund
Content-Type: application/json

{
  "reason": "Produit dÃ©fectueux"
}

### 4.4 Rembourser un paiement - Remboursement partiel (Admin)
POST {{apiUrl}}/pay_1234567890/refund
Content-Type: application/json

{
  "amount": 50.00,
  "reason": "Remboursement partiel - article manquant"
}

### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
### 5. STATISTIQUES & ADMIN
### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### 5.1 Obtenir les statistiques globales
GET {{apiUrl}}/stats
Content-Type: application/json

### 5.2 Obtenir les statistiques avec filtres
GET {{apiUrl}}/stats?status=COMPLETED&startDate=2025-01-01&endDate=2025-12-31
Content-Type: application/json

### 5.3 Lister tous les paiements (Admin)
GET {{apiUrl}}
Content-Type: application/json

### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
### 6. CALLBACKS CYBERPLUS (Simulation)
### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### 6.1 Simuler un callback Cyberplus - Paiement rÃ©ussi
POST {{apiUrl}}/callback/cyberplus
Content-Type: application/json

{
  "transaction_id": "TXN_TEST_001",
  "order_id": "ORD-2025-001",
  "status": "success",
  "amount": "99.99",
  "currency": "EUR",
  "payment_method": "card",
  "signature": "test_signature_hash"
}

### 6.2 Simuler un callback Cyberplus - Paiement Ã©chouÃ©
POST {{apiUrl}}/callback/cyberplus
Content-Type: application/json

{
  "transaction_id": "TXN_TEST_002",
  "order_id": "ORD-2025-002",
  "status": "failed",
  "amount": "149.50",
  "currency": "EUR",
  "payment_method": "card",
  "error_code": "insufficient_funds",
  "signature": "test_signature_hash"
}

### 6.3 Callback success return
POST {{apiUrl}}/callback/success
Content-Type: application/json

{
  "order_id": "ORD-2025-001",
  "transaction_id": "TXN_TEST_001",
  "status": "success"
}

### 6.4 Callback error return
POST {{apiUrl}}/callback/error
Content-Type: application/json

{
  "order_id": "ORD-2025-002",
  "error": "payment_declined",
  "error_message": "Carte refusÃ©e par la banque"
}

### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
### 7. PAIEMENT DE SUPPLÃ‰MENT
### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### 7.1 Initialiser le paiement d'un supplÃ©ment (Paybox)
POST {{apiUrl}}/proceed-supplement
Content-Type: application/json

{
  "orderId": "ORD-2025-SUPPL-001",
  "paymentMethod": "PAYBOX"
}

### 7.2 Initialiser le paiement d'un supplÃ©ment (PayPal)
POST {{apiUrl}}/proceed-supplement
Content-Type: application/json

{
  "orderId": "ORD-2025-SUPPL-002",
  "paymentMethod": "PAYPAL"
}

### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
### 8. SCÃ‰NARIOS DE TEST COMPLETS
### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### 8.1 ScÃ©nario : Paiement simple rÃ©ussi
# Ã‰tape 1 : CrÃ©er le paiement
POST {{apiUrl}}
Content-Type: application/json

{
  "amount": 199.99,
  "currency": "EUR",
  "method": "CYBERPLUS",
  "userId": "scenario-user-001",
  "orderId": "SCENARIO-001",
  "description": "ScÃ©nario test complet",
  "customerEmail": "scenario@test.com"
}

# Ã‰tape 2 : Simuler callback success (copier le paymentReference de l'Ã©tape 1)
# POST {{apiUrl}}/callback/cyberplus
# { ... }

# Ã‰tape 3 : VÃ©rifier le statut
# GET {{apiUrl}}/order/SCENARIO-001

### 8.2 ScÃ©nario : Paiement annulÃ© par utilisateur
# Ã‰tape 1 : CrÃ©er le paiement
POST {{apiUrl}}
Content-Type: application/json

{
  "amount": 79.99,
  "currency": "EUR",
  "method": "CYBERPLUS",
  "userId": "scenario-user-002",
  "orderId": "SCENARIO-002",
  "description": "ScÃ©nario annulation"
}

# Ã‰tape 2 : Annuler le paiement (copier l'ID du paiement)
# POST {{apiUrl}}/{paymentId}/cancel

### 8.3 ScÃ©nario : Paiement avec remboursement
# Ã‰tape 1 : CrÃ©er un paiement dÃ©jÃ  complÃ©tÃ©
POST {{apiUrl}}
Content-Type: application/json

{
  "amount": 299.99,
  "currency": "EUR",
  "method": "CYBERPLUS",
  "userId": "scenario-user-003",
  "orderId": "SCENARIO-003",
  "description": "ScÃ©nario remboursement"
}

# Ã‰tape 2 : Marquer comme complÃ©tÃ© (Admin)
# PATCH {{apiUrl}}/{paymentId}/status
# { "status": "COMPLETED" }

# Ã‰tape 3 : Rembourser
# POST {{apiUrl}}/{paymentId}/refund
# { "amount": 100.00, "reason": "Produit dÃ©fectueux" }

### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
### 9. TESTS DE VALIDATION
### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

### 9.1 Test : Montant nÃ©gatif (doit Ã©chouer)
POST {{apiUrl}}
Content-Type: application/json

{
  "amount": -50.00,
  "currency": "EUR",
  "method": "CYBERPLUS",
  "userId": "test-validation",
  "orderId": "INVALID-001"
}

### 9.2 Test : Montant trop Ã©levÃ© (doit Ã©chouer si > limite)
POST {{apiUrl}}
Content-Type: application/json

{
  "amount": 999999.99,
  "currency": "EUR",
  "method": "CYBERPLUS",
  "userId": "test-validation",
  "orderId": "INVALID-002"
}

### 9.3 Test : MÃ©thode de paiement invalide
POST {{apiUrl}}
Content-Type: application/json

{
  "amount": 100.00,
  "currency": "EUR",
  "method": "INVALID_METHOD",
  "userId": "test-validation",
  "orderId": "INVALID-003"
}

### 9.4 Test : DonnÃ©es manquantes
POST {{apiUrl}}
Content-Type: application/json

{
  "amount": 100.00
}

### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
### 10. NOTES & EXEMPLES DE RÃ‰PONSES
### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Exemple de rÃ©ponse rÃ©ussie :
# {
#   "success": true,
#   "data": {
#     "id": "pay_1234567890",
#     "paymentReference": "PAY_1696502400_ABC123",
#     "status": "pending",
#     "amount": 99.99,
#     "currency": "EUR",
#     "method": "CYBERPLUS",
#     "redirectData": {
#       "html": "...",
#       "url": "https://secure.systempay.fr/vads-payment/",
#       "parameters": { ... }
#     }
#   },
#   "message": "Paiement crÃ©Ã© avec succÃ¨s"
# }

# Exemple de rÃ©ponse d'erreur :
# {
#   "success": false,
#   "statusCode": 400,
#   "message": "Amount must be greater than 0",
#   "error": "Bad Request"
# }

### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
### FIN DES TESTS
### â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
